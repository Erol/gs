#!/usr/bin/env ruby

help = <<EOS
GS(1)

NAME
      gs -- Gemset management

SYNOPSIS
      gs
      gs init
      gs help

DESCRIPTION
      When called with no arguments, it starts a shell session and
      configures the variables GEM_HOME, GEM_PATH and PATH to point to
      the $PWD/.gs directory.

      init
          Creates the $PWD/.gs directory.

      help
          Displays this message.
EOS

rc = <<EOS
. ~/.bashrc

export GEM_HOME="$PWD/.gs"
export GEM_PATH="$PWD/.gs:`gem env path`"
export GEM_SET="`basename $PWD`"
export PATH="$PWD/.gs/bin:$PATH"
EOS

# Start a subshell with the init file .gs/config. If the file doesn't
# exist, exit with an error.
def use
  if Dir.exists?(".gs")
    exec "bash --init-file .gs/config"
  else
    puts "Directory .gs not found. Try `gs help`."
    exit 1
  end
end

# Create the .gs directory and the .gs/config file.
def init(rc)
  Dir.mkdir(".gs")
  File.write(".gs/config", rc)
end

def help
  puts help
end

case ARGV[0]
when "init" then init(rc)
when "help" then puts help
else use
end
